




<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Uppy Server — Uppy</title>
    <meta charset="utf-8">
    <meta name="title" content="Uppy Server — Uppy">
    <meta name="description" content="Uppy is a sleek, modular file uploader that integrates seemlessly with any framework.  It fetches files from local disk, Google Drive, Dropbox, Instagram, remote URLs, cameras and other exciting locations, and then uploads them to the final destination.  It’s fast, easy to use and let&#39;s you worry about more important problems than building a file uploader.
">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@uppy_io">
    <meta name="twitter:creator" content="@uppy_io">
    <meta property="og:url" content="https://uppy.io/docs/server/index.html">
    <meta property="og:title" content="Uppy Server — Uppy">
    <meta name="twitter:title" content="Uppy Server — Uppy">
    <meta name="twitter:description" content="Uppy is a sleek, modular file uploader that integrates seemlessly with any framework.  It fetches files from local disk, Google Drive, Dropbox, Instagram, remote URLs, cameras and other exciting locations, and then uploads them to the final destination.  It’s fast, easy to use and let's you worry about more important problems than building a file uploader.
">
    <meta property="og:image" content="http://uppy.io/images/uppy-social.jpg">
    <meta name="twitter:image" content="http://uppy.io/images/uppy-social.jpg">

    <link rel="icon" href="/images/logos/uppy-dog-head-arrow.png" type="image/x-icon">
    <link rel="alternate" type="application/rss+xml" title="Uppy" href="/atom.xml">

    <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,600|Roboto+Mono" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Poiret+One:400" rel="stylesheet">
    <script>
      window.PAGE_TYPE = "docs"
    </script>
    <link rel="stylesheet" href="/css/main.css">
  </head>
  <body class="page-inner">
    <div class="page">
      <header id="header" class="MainHeader js-MainHeader">
        <button class="MainHeader-menuBtn js-MenuBtn"></button>

        <a id="logo" class="MainLogo" href="/">
          <img class="MainLogo-img" src="/images/logos/uppy-dog-head-arrow.svg">
          <span class="MainLogo-text">Uppy</span>
        </a>

        <nav>
          <ul id="nav" class="MainMenu">
            <!-- @todo uncomment search input when we get our own swifttype -->
<!-- <li>
  <form id="search-form" class="MainMenu-search">
    <input type="text" id="search-query" class="MainMenu-searchQuery st-default-search-input">
  </form>
</li> -->
<!--li><a href="/guide/" class="nav-link">Guide</a></li-->
<li><a href="/docs/" class="nav-link current">Docs</a></li>
<li><a href="/examples/dashboard/" class="nav-link">Examples</a></li>
<!--li><a href="/stats/" class="nav-link">Stats</a></li-->
<li><a href="/blog/" class="nav-link">Blog</a></li>
<li><a href="https://github.com/transloadit/uppy" class="nav-link">Github</a></li>

          </ul>
        </nav>

        <a href="https://github.com/transloadit/uppy" class="github-corner" aria-label="View source on Github">
          <svg width="70" height="70" viewBox="0 0 250 250" style="fill:#E0217D; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
            <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
            <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
            <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
          </svg>
        </a>
        <style></style>
      </header>

      <main class="MainContent js-MainContent" id="main">
        
          
    <div class="Sidebar js-Sidebar">
  <ul class="main-menu">
    <!-- @todo uncomment search input when we get our own swifttype -->
<!-- <li>
  <form id="search-form" class="MainMenu-search">
    <input type="text" id="search-query" class="MainMenu-searchQuery st-default-search-input">
  </form>
</li> -->
<!--li><a href="/guide/" class="nav-link">Guide</a></li-->
<li><a href="/docs/" class="nav-link current">Docs</a></li>
<li><a href="/examples/dashboard/" class="nav-link">Examples</a></li>
<!--li><a href="/stats/" class="nav-link">Stats</a></li-->
<li><a href="/blog/" class="nav-link">Blog</a></li>
<li><a href="https://github.com/transloadit/uppy" class="nav-link">Github</a></li>

  </ul>
  <div class="list">
    <h2>
      
        <a href="/docs">Docs</a>
      
    </h2>
    <ul class="menu-root">
      
        
        
        
          <li>
            <a href="/docs/" class="sidebar-link">Getting Started</a>
          </li>
        
      
        
        
        
          <li>
            <a href="/docs/uppy/" class="sidebar-link">Uppy</a>
          </li>
        
      
        
        
        
          <li>
            <a href="/docs/server/" class="sidebar-link current">Uppy Server</a>
          </li>
        
      
        
        
        
          <li>
            <a href="/docs/stats/" class="sidebar-link">Stats</a>
          </li>
        
      
        
        
        
          <li>
            <h3><a href="/docs/plugins/">Plugins</a></h3>
          </li>
          <li>
            <a href="/docs/plugins/" class="sidebar-link">List & Common Options</a>
          </li>
        
      
        
        
        
          <li>
            <a href="/docs/dashboard/" class="sidebar-link">Dashboard</a>
          </li>
        
      
        
        
        
          <li>
            <a href="/docs/dragdrop/" class="sidebar-link">DragDrop</a>
          </li>
        
      
        
        
        
          <li>
            <a href="/docs/statusbar/" class="sidebar-link">StatusBar</a>
          </li>
        
      
        
        
        
          <li>
            <a href="/docs/tus/" class="sidebar-link">Tus10</a>
          </li>
        
      
        
        
        
          <li>
            <a href="/docs/xhrupload/" class="sidebar-link">XHRUpload</a>
          </li>
        
      
        
        
        
          <li>
            <a href="/docs/aws-s3/" class="sidebar-link">AwsS3</a>
          </li>
        
      
        
        
        
          <li>
            <a href="/docs/transloadit/" class="sidebar-link">Transloadit</a>
          </li>
        
      
        
        
        
          <li>
            <a href="/docs/golden-retriever/" class="sidebar-link">Golden Retriever</a>
          </li>
        
      
        
        
        
          <li>
            <h3><a href="/docs/react/">React Components</a></h3>
          </li>
          <li>
            <a href="/docs/react/" class="sidebar-link">Introduction</a>
          </li>
        
      
        
        
        
          <li>
            <a href="/docs/react/dashboard-modal/" class="sidebar-link">DashboardModal</a>
          </li>
        
      
        
        
        
          <li>
            <a href="/docs/react/redux-sync/" class="sidebar-link">Redux</a>
          </li>
        
      
    </ul>
    <ul class="Social">
  <li><a href="https://twitter.com/uppy_io" class="twitter-follow-button" data-show-count="false" data-dnt="true">Follow @uppy_io</a></li>
  <li><iframe src="https://ghbtns.com/github-btn.html?user=transloadit&repo=uppy&type=watch&count=true"
allowtransparency="true" frameborder="0" scrolling="0" width="100" height="20"></iframe></li>
  <!-- to regenerate you can use this link: https://img.shields.io/badge/community-forum-d8006a.svg -->
  <li><a href="https://community.transloadit.com/c/uppy"><img src="/images/community-forum-d8006a.svg" /> </a></li>
  <li class="BuildBadge">
   <span class="wrapper">
     <a href="https://travis-ci.org/transloadit/uppy"><img src="https://travis-ci.org/transloadit/uppy.svg" alt="Build Status"></a>
   </span>
  </li>
  <li class="SauceBadge">
   <span class="wrapper">
     <a href="https://saucelabs.com/u/transloadit-uppy">
       <img src="https://saucelabs.com/buildstatus/transloadit-uppy" alt="Sauce Test Status"/>
     </a>
   </span>
  </li>
</ul>

  </div>
</div>


<div class="Content js-Content docs with-sidebar">
    <h1>Uppy Server</h1>
    <p>Drag and Drop, Webcam, basic file manipulation (adding metadata, for example) and uploading via tus resumable uploads or XHR/Multipart are all possible using just the uppy client module. </p>
<p>However, if you add <a href="https://github.com/transloadit/uppy-server" target="_blank" rel="external">uppy-server</a> to the mix, your users will be able to select files from remote sources, such as Instagram, Google Drive and Dropbox, bypassing the client (so a 5 GB video isn’t eating into your mobile data plan), and then uploaded to the final distanation. Files are removed from uppy-server after an upload is complete, or after a resonable timeout. Access tokens also don’t stick around for long, for security.</p>
<p>Uppy Server handles the server-to-server communication between your server and file storage providers such as Google Drive, Dropbox, Instagram, etc.</p>
<h2 id="Supported-Providers"><a href="#Supported-Providers" class="headerlink" title="Supported Providers"></a>Supported Providers</h2><p>As of now uppy-server is integrated to work with:</p>
<ul>
<li>Google Drive</li>
<li>Dropbox</li>
<li>Instagram</li>
<li>Amazon S3</li>
<li>Local disk</li>
</ul>
<h2 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h2><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">npm install uppy-server</div></pre></td></tr></table></figure>
<h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><p>Uppy-server may either be used as pluggable express app, which you plug to your already existing server, or it may simply be run as a standalone server:</p>
<h3 id="Plug-to-already-existing-server"><a href="#Plug-to-already-existing-server" class="headerlink" title="Plug to already existing server"></a>Plug to already existing server</h3><p>To plug uppy-server to an existing server, simply call on it’s <code>.app</code> method, passing in an <a href="#Options">options</a> object as parameter.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</div><div class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>)</div><div class="line"><span class="keyword">var</span> uppy = <span class="built_in">require</span>(<span class="string">'uppy-server'</span>)</div><div class="line"></div><div class="line"><span class="keyword">var</span> app = express()</div><div class="line">app.use(bodyParser.json())</div><div class="line">...</div><div class="line"><span class="comment">// be sure to place this anywhere after app.use(bodyParser.json())</span></div><div class="line"><span class="keyword">const</span> options = &#123;</div><div class="line">  <span class="attr">providerOptions</span>: &#123;</div><div class="line">    <span class="attr">google</span>: &#123;</div><div class="line">      <span class="attr">key</span>: <span class="string">'GOOGLE_KEY'</span>,</div><div class="line">      <span class="attr">secret</span>: <span class="string">'GOOGLE_SECRET'</span></div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">server</span>: &#123;</div><div class="line">    <span class="attr">host</span>: <span class="string">'localhost:3020'</span>,</div><div class="line">    <span class="attr">protocol</span>: <span class="string">'http'</span>,</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">filePath</span>: <span class="string">'/path/to/folder/'</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">app.use(uppy.app(options))</div></pre></td></tr></table></figure>
<p><a href="#Options">See</a> for valid configuration options.</p>
<p>To enable uppy socket for realtime feed to the client while upload is going on, you call the <code>socket</code> method like so.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">...</div><div class="line">var server = app.listen(PORT)</div><div class="line"></div><div class="line">uppy.socket(server, options)</div></pre></td></tr></table></figure>
<p>This takes your <code>server</code> instance and your uppy <a href="#Options">options</a> as parameters.</p>
<h3 id="Run-as-standalone-server"><a href="#Run-as-standalone-server" class="headerlink" title="Run as standalone server"></a>Run as standalone server</h3><p>Please ensure that the required env varaibles are set before runnning/using uppy-server as a standalone server. <a href="#Configure-Standalone">See</a>.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">$ uppy-server</div></pre></td></tr></table></figure>
<p>If you cloned the repo from gtihub and want to run it as a standalone server, you may also run the following command from within its<br>directory</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">npm run start:production</div></pre></td></tr></table></figure>
<h4 id="Configure-Standalone"><a href="#Configure-Standalone" class="headerlink" title="Configure Standalone"></a>Configure Standalone</h4><p>To run uppy-server as a standalone server, you are required to set your uppy <a href="#Options">options</a> via environment variables</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line"><span class="comment">####### Mandatory variables ###########</span></div><div class="line"></div><div class="line"><span class="comment"># any long set of random characters for the server session</span></div><div class="line"><span class="built_in">export</span> UPPYSERVER_SECRET=<span class="string">"shh!Issa Secret!"</span></div><div class="line"><span class="comment"># corresponds to the server.host option</span></div><div class="line"><span class="built_in">export</span> UPPYSERVER_DOMAIN=<span class="string">"YOUR SERVER DOMAIN"</span></div><div class="line"><span class="comment"># corresponds to the filePath option</span></div><div class="line"><span class="built_in">export</span> UPPYSERVER_DATADIR=<span class="string">"PATH/TO/DOWNLOAD/DIRECTORY"</span></div><div class="line"></div><div class="line"><span class="comment">###### Optionional variables ##########</span></div><div class="line"></div><div class="line"><span class="comment"># corresponds to the server.protocol option. defaults to http</span></div><div class="line"><span class="built_in">export</span> UPPYSERVER_PROTOCOL=<span class="string">"YOUR SERVER PROTOCOL"</span></div><div class="line"><span class="comment"># the port to start the server on. defaults to 3020</span></div><div class="line"><span class="built_in">export</span> UPPYSERVER_PORT=<span class="string">"YOUR SERVER PORT"</span></div><div class="line"><span class="comment"># corresponds to the server.port option. defaults to ''</span></div><div class="line"><span class="built_in">export</span> UPPYSERVER_PATH=<span class="string">"/SERVER/PATH/TO/WHERE/UPPY-SERVER/LIVES"</span></div><div class="line"></div><div class="line"><span class="comment"># use this in place of UPPYSERVER_PATH if the server path should not be</span></div><div class="line"><span class="comment"># handled by the express.js app but maybe by an external server configuration</span></div><div class="line"><span class="comment"># instead (e.g Nginx).</span></div><div class="line"><span class="built_in">export</span> UPPYSERVER_IMPLICIT_PATH=<span class="string">"/SERVER/PATH/TO/WHERE/UPPY/SERVER/LIVES"</span></div><div class="line"></div><div class="line"><span class="comment"># comma separated client hosts to whitlelist by the server</span></div><div class="line"><span class="comment"># if not specified, the server would allow any host</span></div><div class="line"><span class="built_in">export</span> UPPY_ENDPOINTS=<span class="string">"localhost:3452,uppy.io"</span></div><div class="line"></div><div class="line"><span class="comment"># corresponds to the redisUrl option</span></div><div class="line"><span class="comment"># This also enables redis session storage if set</span></div><div class="line"><span class="built_in">export</span> UPPYSERVER_REDIS_URL=<span class="string">"REDIS URL"</span> </div><div class="line"></div><div class="line"><span class="comment"># to enable Dropbox</span></div><div class="line"><span class="built_in">export</span> UPPYSERVER_DROPBOX_KEY=<span class="string">"YOUR DROPBOX KEY"</span></div><div class="line"><span class="built_in">export</span> UPPYSERVER_DROPBOX_SECRET=<span class="string">"YOUR DROPBOX SECRET"</span></div><div class="line"></div><div class="line"><span class="comment"># to enable Google Drive</span></div><div class="line"><span class="built_in">export</span> UPPYSERVER_GOOGLE_KEY=<span class="string">"YOUR GOOGLE KEY"</span></div><div class="line"><span class="built_in">export</span> UPPYSERVER_GOOGLE_SECRET=<span class="string">"YOUR GOOGLE SECRET"</span></div><div class="line"></div><div class="line"><span class="comment"># to enable Instagram</span></div><div class="line"><span class="built_in">export</span> UPPYSERVER_INSTAGRAM_KEY=<span class="string">"YOUR INSTAGRAM KEY"</span></div><div class="line"><span class="built_in">export</span> UPPYSERVER_INSTAGRAM_SECRET=<span class="string">"YOUR INSTAGRAM SECRET"</span></div><div class="line"></div><div class="line"><span class="comment"># to enable s3</span></div><div class="line"><span class="built_in">export</span> UPPYSERVER_AWS_KEY=<span class="string">"YOUR AWS KEY"</span></div><div class="line"><span class="built_in">export</span> UPPYSERVER_AWS_SECRET=<span class="string">"YOUR AWS SECRET"</span></div><div class="line"><span class="built_in">export</span> UPPYSERVER_AWS_BUCKET=<span class="string">"YOUR AWS S3 BUCKET"</span></div><div class="line"><span class="built_in">export</span> UPPYSERVER_AWS_REGION=<span class="string">"AWS REGION"</span></div><div class="line"></div><div class="line"><span class="comment"># corresponds to the server.oauthDomain option</span></div><div class="line"><span class="built_in">export</span> UPPYSERVER_OAUTH_DOMAIN=<span class="string">"sub.domain.com"</span></div><div class="line"><span class="comment"># corresponds to the server.validHosts option</span></div><div class="line"><span class="built_in">export</span> UPPYSERVER_DOMAINS=<span class="string">"sub1.domain.com,sub2.domain.com,sub3.domain.com"</span></div><div class="line"></div><div class="line"><span class="comment"># corresponds to the sendSelfEndpoint option</span></div><div class="line"><span class="built_in">export</span> UPPYSERVER_SELF_ENDPOINT=<span class="string">"THIS SHOULD BE SAME AS YOUR DOMAIN + PATH"</span></div><div class="line"></div><div class="line"><span class="comment"># comma separated urls</span></div><div class="line"><span class="comment"># corresponds to the uploadUrls option</span></div><div class="line"><span class="built_in">export</span> UPPYSERVER_UPLOAD_URLS=<span class="string">"http://master.tus.io/files/,https://master.tus.io/files/"</span></div></pre></td></tr></table></figure>
<p>See <a href="https://github.com/transloadit/uppy-server/blob/master/env.example.sh" target="_blank" rel="external">env.example.sh</a> for an example configuration script.</p>
<h3 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">providerOptions</span>: &#123;</div><div class="line">    <span class="attr">google</span>: &#123;</div><div class="line">      <span class="attr">key</span>: <span class="string">"***"</span>,</div><div class="line">      <span class="attr">secret</span>: <span class="string">"***"</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">dropbox</span>: &#123;</div><div class="line">      <span class="attr">key</span>: <span class="string">"***"</span>,</div><div class="line">      <span class="attr">secret</span>: <span class="string">"***"</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">instagram</span>: &#123;</div><div class="line">      <span class="attr">key</span>: <span class="string">"***"</span>,</div><div class="line">      <span class="attr">secret</span>: <span class="string">"***"</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">s3</span>: &#123;</div><div class="line">      <span class="attr">key</span>: <span class="string">"***"</span>,</div><div class="line">      <span class="attr">secret</span>: <span class="string">"***"</span>,</div><div class="line">      <span class="attr">bucket</span>: <span class="string">"bucke-name"</span>,</div><div class="line">      <span class="attr">region</span>: <span class="string">"us-east-1"</span></div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">server</span>: &#123;</div><div class="line">    <span class="attr">host</span>: <span class="string">"localhost:3020"</span>, <span class="comment">// or yourdomain.com</span></div><div class="line">    protocol: <span class="string">"http"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">filePath</span>: <span class="string">"path/to/download/folder"</span>,</div><div class="line">  <span class="attr">sendSelfEndpoint</span>: <span class="string">"localhost:3020"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li><p><strong>filePath(required)</strong> - Full path to the directory where provider files would temporarily be downloaded to.</p>
</li>
<li><p><strong>redisUrl(optional)</strong> - URL to running redis server. If this is set, the state of uploads would be stored temporarily. This helps for resumed uploads after a browser crash from the client. The stored upload would be sent back to the client on reconnection.</p>
</li>
<li><p><strong>providerOptions(optional)</strong> - An object containing credentials (<code>key</code> and <code>secret</code>) for each provider you would like to enable. Please <a href="#Supported-Providers">see</a> for supported providers.</p>
</li>
<li><p><strong>server(optional)</strong> - An object with details mainly used to carry out oauth authentication from any of the enable providers above. Though it is optional, it is required if you would be enabling any of the supported providers. The following are the server options you may set</p>
<ul>
<li>protocol - <code>http | https</code></li>
<li>host(required) - your server host (e.g localhost:3020, mydomain.com)</li>
<li>path - the server path to where the uppy app is sitting (e.g if uppy server is at <code>mydomain.com/uppy</code>, then the path would be <code>/uppy</code>).</li>
<li>oauthDoamin - if you have multiple instances of uppy server with different(and maybe dynamic) subdomains, you can set a master domain(e.g <code>sub1.mydomain.com</code>) to handle your oauth authentication for you. This would then redirect to the slave subdomain with the required credentials on completion.</li>
<li>validHosts - if you are setting a master <code>oauthDomain</code>, you need to set a list of valid hosts, so the master oauth handler can validate the host of the uppy instance requesting the authentication. This is basically a list of valid domains running your uppy server instances. The list may also contain regex patterns. e.g <code>[&#39;sub2.mydomain.com&#39;, &#39;sub3.mydomain.com&#39;, &#39;(\\w+).mydomain.com&#39;]</code></li>
</ul>
</li>
<li><p><strong>sendSelfEndpoint(optional)</strong> - This is basically the same as the <code>server.host + server.path</code> attributes. The major reason for this attributes is that, when set, it adds the value as the <code>i-am</code> header of every request response.</p>
</li>
<li><p><strong>customProviders(optional)</strong> - This option enables you add custom providers along with the already supported providers. <a href="#Adding-Custom-Providers">See</a> for more.</p>
</li>
<li><p><strong>uploadUrls(optional)</strong> - An array of urls (full path), which uppy-server should only upload to.</p>
</li>
</ol>
<h3 id="Adding-Custom-Providers"><a href="#Adding-Custom-Providers" class="headerlink" title="Adding Custom Providers"></a>Adding Custom Providers</h3><p>As of now, uppy-server supports <strong>Google Drive</strong>, <strong>Dropbox</strong> and <strong>Instagram</strong> out of the box, but you may also choose to add your custom providers. You can do this by passing the <code>customPrivders</code><br>option when calling the uppy <code>app</code> method. The custom provider is expected to supoort Oauth 1 or 2 for authentication/authorization.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">let</span> options = &#123;</div><div class="line">    <span class="attr">customProviders</span>: &#123;</div><div class="line">        <span class="attr">myprovidername</span>: &#123;</div><div class="line">            <span class="attr">config</span>: &#123;</div><div class="line">                <span class="attr">authorize_url</span>: <span class="string">"https://mywebsite.com/authorize"</span>,</div><div class="line">                <span class="attr">access_url</span>: <span class="string">"https://mywebsite.com/token"</span>,</div><div class="line">                <span class="attr">oauth</span>: <span class="number">2</span>,</div><div class="line">                <span class="attr">key</span>: <span class="string">"***"</span>,</div><div class="line">                <span class="attr">secret</span>: <span class="string">"**"</span>,</div><div class="line">                <span class="attr">scope</span>: [<span class="string">"read"</span>, <span class="string">"write"</span>]</div><div class="line">            &#125;,</div><div class="line">            <span class="attr">module</span>: <span class="built_in">require</span>(<span class="string">'/path/to/provider/module'</span>)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">uppy.app(options)</div></pre></td></tr></table></figure>
<p>The <code>customProviders</code> option should be an object containing each custom provider. Each custom provider would in turn be an object with two keys, <code>config</code> and <code>module</code>. The <code>config</code> option would contain Oauth API settings, while the <code>module</code> would point to the provider module.</p>
<p>To work well with uppy server, the <strong>Module</strong> must be a class with the following methods.</p>
<ol>
<li><code>list (options, done)</code> - lists json data of user files (e.g list of all the files in a particular directory).<ul>
<li><code>options</code> - is an object containing the following attributes<ul>
<li>token - authorization token(retrieved from oauth process) to send along with your request</li>
<li>directory - the <code>id/name</code> of the directory whose data is to be retrieved. This may be ignored if it doesn’t apply to your provider</li>
<li>query - expressjs query params object received by the server(just in case there’s some data you need in there).</li>
</ul>
</li>
<li><code>done (err, response, body)</code> - the callback that should be called when the request to your provider is done. As the signature indicates the following data should be passed along to the callback <code>err</code>, <code>response</code>, and <code>body</code>.</li>
</ul>
</li>
<li><code>download (options, onData, onResponse)</code> - downloads a particular file from the provider.<ul>
<li><code>options</code> - is an object containing the following attributes<ul>
<li>token - authorization token(retrieved from oauth process) to send along with your request.</li>
<li>id - id of the file being downloaded.</li>
</ul>
</li>
<li><code>onData (chunk)</code> - a callback that should be called with each data chunk received on download. This is useful if the size of the downloaded file can be pre-determined. This would allow for pipelined upload of the file(to the desired destination), while the download is still going on.</li>
<li><code>onResponse (response)</code> - if the size of the downloaded file can not be pre-determined by uppy-server, then this callback should be called in place of the <code>onData</code> callback. This callback would be called after the download is done, and would the downloaded data(response) as argument.</li>
</ul>
</li>
</ol>
<h2 id="Development"><a href="#Development" class="headerlink" title="Development"></a>Development</h2><p>1. To setup uppy-server for local development, please clone the repo and install like so:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">git <span class="built_in">clone</span> https://github.com/transloadit/uppy-server &amp;&amp; <span class="built_in">cd</span> uppy-server &amp;&amp; npm install</div></pre></td></tr></table></figure>
<p>2. Configure your enviorment variables by copying the <code>env.example.sh</code> file to <code>env.sh</code> and edit it to its correct values.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">cp env.example.sh env.sh</div><div class="line"><span class="variable">$EDITOR</span> env.sh</div></pre></td></tr></table></figure>
<p>3. To start the server, simply run:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">npm run start</div></pre></td></tr></table></figure>
<p>This would get the uppy-server running on <code>http://localhost:3020</code>.</p>
<p>It also expects the <a href="https://github.com/transloadit/uppy" target="_blank" rel="external">uppy client</a> to be running on <code>http://localhost:3452</code></p>
<h2 id="Running-example"><a href="#Running-example" class="headerlink" title="Running example"></a>Running example</h2><p>An example server is running at <a href="http://server.uppy.io" target="_blank" rel="external">http://server.uppy.io</a>, which is deployed via<br><a href="https://github.com/kvz/frey" target="_blank" rel="external">Frey</a>, using the following <a href="infra/Freyfile.toml">Freyfile</a>.</p>
<p>All the secrets are stored in <code>env.infra.sh</code>, so using <code>env.infra.example.sh</code>, you could<br>use the same Freyfile but target a different cloud vendor with different secrets, and run your own<br>uppy-server.</p>
<h2 id="Logging"><a href="#Logging" class="headerlink" title="Logging"></a>Logging</h2><p>Requires Frey, if you haven’t set it up yet type</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">npm run install:frey</div></pre></td></tr></table></figure>
<p>afterwards, production logs are available through:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">npm run logtail</div></pre></td></tr></table></figure>
<p>This requires at least the <code>FREY_ENCRYPTION_SECRET</code> key present in your <code>./env.sh</code>.</p>

    
    <div class="footer">Caught a mistake or want to contribute to the documentation?
       <a href="https://github.com/transloadit/uppy/blob/master/website/src/docs/server.md" target="_blank">Edit/fork this page directly on Github</a>!
    </div>
</div>

        
      </main>

      <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63083-12', 'uppy.io');
  ga('send', 'pageview');
</script>


      
        <script src="/js/smooth-scroll.min.js"></script>
      
      <script src="/js/common.js"></script>

      <!-- Twitter follow button script -->
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

      <!--script src="//ajax.googleapis.com/ajax/libs/webfont/1.6.16/webfont.js"></script>
      <script>
        WebFont.load({
          google: {
            families: ['Source Sans Pro:400,600', 'Roboto Mono', 'Poiret One:400']
          }
        });
      </script-->
    </div>
  </body>
</html>
