




<!DOCTYPE html>
<html lang="en">
  <head>
    <title>AwsS3 — Uppy</title>
    <meta charset="utf-8">
    <meta name="title" content="AwsS3 — Uppy">
    <meta name="description" content="Uppy is a sleek, modular file uploader that integrates seemlessly with any framework.  It fetches files from local disk, Google Drive, Dropbox, Instagram, remote URLs, cameras and other exciting locations, and then uploads them to the final destination.  It’s fast, easy to use and let&#39;s you worry about more important problems than building a file uploader.
">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@uppy_io">
    <meta name="twitter:creator" content="@uppy_io">
    <meta property="og:url" content="https://uppy.io/docs/aws-s3/index.html">
    <meta property="og:title" content="AwsS3 — Uppy">
    <meta name="twitter:title" content="AwsS3 — Uppy">
    <meta name="twitter:description" content="Uppy is a sleek, modular file uploader that integrates seemlessly with any framework.  It fetches files from local disk, Google Drive, Dropbox, Instagram, remote URLs, cameras and other exciting locations, and then uploads them to the final destination.  It’s fast, easy to use and let's you worry about more important problems than building a file uploader.
">
    <meta property="og:image" content="http://uppy.io/images/uppy-social.jpg">
    <meta name="twitter:image" content="http://uppy.io/images/uppy-social.jpg">

    <link rel="icon" href="/images/logos/uppy-dog-head-arrow.png" type="image/x-icon">
    <link rel="alternate" type="application/rss+xml" title="Uppy" href="/atom.xml">

    <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,600|Roboto+Mono" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Poiret+One:400" rel="stylesheet">
    <script>
      window.PAGE_TYPE = "docs"
    </script>
    <link rel="stylesheet" href="/css/main.css">
  </head>
  <body class="page-inner">
    <div class="page">
      <header id="header" class="MainHeader js-MainHeader">
        <button class="MainHeader-menuBtn js-MenuBtn"></button>

        <a id="logo" class="MainLogo" href="/">
          <img class="MainLogo-img" src="/images/logos/uppy-dog-head-arrow.svg">
          <span class="MainLogo-text">Uppy</span>
        </a>

        <nav>
          <ul id="nav" class="MainMenu">
            <!-- @todo uncomment search input when we get our own swifttype -->
<!-- <li>
  <form id="search-form" class="MainMenu-search">
    <input type="text" id="search-query" class="MainMenu-searchQuery st-default-search-input">
  </form>
</li> -->
<!--li><a href="/guide/" class="nav-link">Guide</a></li-->
<li><a href="/docs/" class="nav-link current">Docs</a></li>
<li><a href="/examples/dashboard/" class="nav-link">Examples</a></li>
<!--li><a href="/stats/" class="nav-link">Stats</a></li-->
<li><a href="/blog/" class="nav-link">Blog</a></li>
<li><a href="https://github.com/transloadit/uppy" class="nav-link">Github</a></li>

          </ul>
        </nav>

        <a href="https://github.com/transloadit/uppy" class="github-corner" aria-label="View source on Github">
          <svg width="70" height="70" viewBox="0 0 250 250" style="fill:#E0217D; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
            <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
            <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
            <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
          </svg>
        </a>
        <style></style>
      </header>

      <main class="MainContent js-MainContent" id="main">
        
          
    <div class="Sidebar js-Sidebar">
  <ul class="main-menu">
    <!-- @todo uncomment search input when we get our own swifttype -->
<!-- <li>
  <form id="search-form" class="MainMenu-search">
    <input type="text" id="search-query" class="MainMenu-searchQuery st-default-search-input">
  </form>
</li> -->
<!--li><a href="/guide/" class="nav-link">Guide</a></li-->
<li><a href="/docs/" class="nav-link current">Docs</a></li>
<li><a href="/examples/dashboard/" class="nav-link">Examples</a></li>
<!--li><a href="/stats/" class="nav-link">Stats</a></li-->
<li><a href="/blog/" class="nav-link">Blog</a></li>
<li><a href="https://github.com/transloadit/uppy" class="nav-link">Github</a></li>

  </ul>
  <div class="list">
    <h2>
      
        <a href="/docs">Docs</a>
      
    </h2>
    <ul class="menu-root">
      
        
        
        
          <li>
            <a href="/docs/" class="sidebar-link">Getting Started</a>
          </li>
        
      
        
        
        
          <li>
            <a href="/docs/uppy/" class="sidebar-link">Uppy</a>
          </li>
        
      
        
        
        
          <li>
            <a href="/docs/server/" class="sidebar-link">Uppy Server</a>
          </li>
        
      
        
        
        
          <li>
            <a href="/docs/stats/" class="sidebar-link">Stats</a>
          </li>
        
      
        
        
        
          <li>
            <h3><a href="/docs/plugins/">Plugins</a></h3>
          </li>
          <li>
            <a href="/docs/plugins/" class="sidebar-link">List & Common Options</a>
          </li>
        
      
        
        
        
          <li>
            <a href="/docs/dashboard/" class="sidebar-link">Dashboard</a>
          </li>
        
      
        
        
        
          <li>
            <a href="/docs/dragdrop/" class="sidebar-link">DragDrop</a>
          </li>
        
      
        
        
        
          <li>
            <a href="/docs/statusbar/" class="sidebar-link">StatusBar</a>
          </li>
        
      
        
        
        
          <li>
            <a href="/docs/tus/" class="sidebar-link">Tus10</a>
          </li>
        
      
        
        
        
          <li>
            <a href="/docs/xhrupload/" class="sidebar-link">XHRUpload</a>
          </li>
        
      
        
        
        
          <li>
            <a href="/docs/aws-s3/" class="sidebar-link current">AwsS3</a>
          </li>
        
      
        
        
        
          <li>
            <a href="/docs/transloadit/" class="sidebar-link">Transloadit</a>
          </li>
        
      
        
        
        
          <li>
            <a href="/docs/golden-retriever/" class="sidebar-link">Golden Retriever</a>
          </li>
        
      
        
        
        
          <li>
            <h3><a href="/docs/react/">React Components</a></h3>
          </li>
          <li>
            <a href="/docs/react/" class="sidebar-link">Introduction</a>
          </li>
        
      
        
        
        
          <li>
            <a href="/docs/react/dashboard-modal/" class="sidebar-link">DashboardModal</a>
          </li>
        
      
        
        
        
          <li>
            <a href="/docs/react/redux-sync/" class="sidebar-link">Redux</a>
          </li>
        
      
    </ul>
    <ul class="Social">
  <li><a href="https://twitter.com/uppy_io" class="twitter-follow-button" data-show-count="false" data-dnt="true">Follow @uppy_io</a></li>
  <li><iframe src="https://ghbtns.com/github-btn.html?user=transloadit&repo=uppy&type=watch&count=true"
allowtransparency="true" frameborder="0" scrolling="0" width="100" height="20"></iframe></li>
  <!-- to regenerate you can use this link: https://img.shields.io/badge/community-forum-d8006a.svg -->
  <li><a href="https://community.transloadit.com/c/uppy"><img src="/images/community-forum-d8006a.svg" /> </a></li>
  <li class="BuildBadge">
   <span class="wrapper">
     <a href="https://travis-ci.org/transloadit/uppy"><img src="https://travis-ci.org/transloadit/uppy.svg" alt="Build Status"></a>
   </span>
  </li>
  <li class="SauceBadge">
   <span class="wrapper">
     <a href="https://saucelabs.com/u/transloadit-uppy">
       <img src="https://saucelabs.com/buildstatus/transloadit-uppy" alt="Sauce Test Status"/>
     </a>
   </span>
  </li>
</ul>

  </div>
</div>


<div class="Content js-Content docs with-sidebar">
    <h1>AwsS3</h1>
    <p>The <code>AwsS3</code> plugin can be used to upload files directly to an S3 bucket.</p>
<p>As of now, the <code>AwsS3</code> plugin “decorates” the XHRUpload plugin.<br>To upload files directly to S3, both the XHRUpload and AwsS3 plugins must be used:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// No options have to be provided to the XHRUpload plugin,</span></div><div class="line"><span class="comment">// the S3 plugin will configure it.</span></div><div class="line">uppy.use(XHRUpload)</div><div class="line">uppy.use(AwsS3, &#123;</div><div class="line">  <span class="comment">// Options for S3</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h2 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h2><h3 id="host"><a href="#host" class="headerlink" title="host"></a><code>host</code></h3><p>When using <a href="/docs/server/index.html">uppy-server</a> to sign S3 uploads, set this option to the root URL of the uppy-server.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line">uppy.use(XHRUpload)</div><div class="line">uppy.use(AwsS3, &#123;</div><div class="line">  <span class="attr">host</span>: <span class="string">'https://uppy-server.my-app.com/'</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="getUploadParameters-file"><a href="#getUploadParameters-file" class="headerlink" title="getUploadParameters(file)"></a><code>getUploadParameters(file)</code></h3><blockquote>
<p>Note: When using <a href="/docs/server/index.html">uppy-server</a> to sign S3 uploads, do not define this option.</p>
</blockquote>
<p>A function returning upload parameters for a file.<br>Parameters should be returned as an object, or a Promise for an object, with keys <code>{ method, url, fields }</code>.</p>
<p>The <code>method</code> field is the HTTP method to use for the upload.<br>This should be one of <code>PUT</code> or <code>POST</code>, depending on the type of upload used.</p>
<p>The <code>url</code> field is the URL to send the upload request to.<br>When using a presigned PUT upload, this should be the URL to the S3 object including signing parameters in the query string.<br>When using a POST upload with a policy document, this should be the root URL of the bucket.</p>
<p>The <code>fields</code> field is an object with form fields to send along with the upload request.<br>For presigned PUT uploads, this should be empty.</p>
<h2 id="S3-Bucket-configuration"><a href="#S3-Bucket-configuration" class="headerlink" title="S3 Bucket configuration"></a>S3 Bucket configuration</h2><p>S3 buckets do not allow public uploads by default.<br>In order to allow Uppy to upload to a bucket directly, its CORS permissions need to be configured.</p>
<p>CORS permissions can be found in the <a href="https://console.aws.amazon.com/s3/home" target="_blank" rel="external">S3 Management Console</a>.<br>Click the bucket that will receive the uploads, then go into the “Permissions” tab and select the “CORS configuration” button.<br>An XML document will be shown that contains the CORS configuration.</p>
<p>Good practice is to use two CORS rules: one for viewing the uploaded files, and one for uploading files.</p>
<p>Depending on which settings were enabled during bucket creation, AWS S3 may have defined a CORS rule that allows public reading already.<br>This rule looks like:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">CORSRule</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">AllowedOrigin</span>&gt;</span>*<span class="tag">&lt;/<span class="name">AllowedOrigin</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">AllowedMethod</span>&gt;</span>GET<span class="tag">&lt;/<span class="name">AllowedMethod</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">MaxAgeSeconds</span>&gt;</span>3000<span class="tag">&lt;/<span class="name">MaxAgeSeconds</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">CORSRule</span>&gt;</span></div></pre></td></tr></table></figure>
<p>If uploaded files should be publically viewable, but a rule like this is not present, add it.</p>
<p>A different <code>&lt;CORSRule&gt;</code> is necessary to allow uploading.<br>This rule should come <em>before</em> the existing rule, because S3 only uses the first rule that matches the origin of the request.</p>
<p>At minimum, the domain from which the uploads will happen must be whitelisted, and the definitions from the previous rule must be added:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">AllowedOrigin</span>&gt;</span>https://my-app.com<span class="tag">&lt;/<span class="name">AllowedOrigin</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">AllowedMethod</span>&gt;</span>GET<span class="tag">&lt;/<span class="name">AllowedMethod</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">MaxAgeSeconds</span>&gt;</span>3000<span class="tag">&lt;/<span class="name">MaxAgeSeconds</span>&gt;</span></div></pre></td></tr></table></figure>
<p>When using uppy-server, which generates a POST policy document, the following permissions must be granted:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">AllowedMethod</span>&gt;</span>POST<span class="tag">&lt;/<span class="name">AllowedMethod</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">AllowedHeader</span>&gt;</span>Authorization<span class="tag">&lt;/<span class="name">AllowedHeader</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">AllowedHeader</span>&gt;</span>x-amz-date<span class="tag">&lt;/<span class="name">AllowedHeader</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">AllowedHeader</span>&gt;</span>x-amz-content-sha256<span class="tag">&lt;/<span class="name">AllowedHeader</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">AllowedHeader</span>&gt;</span>content-type<span class="tag">&lt;/<span class="name">AllowedHeader</span>&gt;</span></div></pre></td></tr></table></figure>
<p>When using a presigned upload URL, the following permissions must be granted:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">AllowedMethod</span>&gt;</span>PUT<span class="tag">&lt;/<span class="name">AllowedMethod</span>&gt;</span></div></pre></td></tr></table></figure>
<p>The final configuration should look something like the below:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">CORSConfiguration</span> <span class="attr">xmlns</span>=<span class="string">"http://s3.amazonaws.com/doc/2006-03-01/"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">CORSRule</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">AllowedOrigin</span>&gt;</span>https://my-app.com<span class="tag">&lt;/<span class="name">AllowedOrigin</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">AllowedMethod</span>&gt;</span>GET<span class="tag">&lt;/<span class="name">AllowedMethod</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">AllowedMethod</span>&gt;</span>POST<span class="tag">&lt;/<span class="name">AllowedMethod</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">MaxAgeSeconds</span>&gt;</span>3000<span class="tag">&lt;/<span class="name">MaxAgeSeconds</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">AllowedHeader</span>&gt;</span>Authorization<span class="tag">&lt;/<span class="name">AllowedHeader</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">AllowedHeader</span>&gt;</span>x-amz-date<span class="tag">&lt;/<span class="name">AllowedHeader</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">AllowedHeader</span>&gt;</span>x-amz-content-sha256<span class="tag">&lt;/<span class="name">AllowedHeader</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">AllowedHeader</span>&gt;</span>content-type<span class="tag">&lt;/<span class="name">AllowedHeader</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">CORSRule</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">CORSRule</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">AllowedOrigin</span>&gt;</span>*<span class="tag">&lt;/<span class="name">AllowedOrigin</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">AllowedMethod</span>&gt;</span>GET<span class="tag">&lt;/<span class="name">AllowedMethod</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">MaxAgeSeconds</span>&gt;</span>3000<span class="tag">&lt;/<span class="name">MaxAgeSeconds</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">CORSRule</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">CORSConfiguration</span>&gt;</span></div></pre></td></tr></table></figure>
<p>In-depth documentation about CORS rules is available on the <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/cors.html" target="_blank" rel="external">AWS documentation site</a>.</p>
<h2 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h2><h3 id="Generating-a-presigned-upload-URL-server-side"><a href="#Generating-a-presigned-upload-URL-server-side" class="headerlink" title="Generating a presigned upload URL server-side"></a>Generating a presigned upload URL server-side</h3><p>The <code>getUploadParameters</code> function can return a Promise, so upload parameters can be prepared server-side.<br>That way, no private keys to the S3 bucket need to be shared on the client.<br>For example, there could be a PHP server endpoint that prepares a presigned URL for a file:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line">uppy</div><div class="line">  .use(XHRUpload)</div><div class="line">  .use(AwsS3, &#123;</div><div class="line">    getUploadParameters (file) &#123;</div><div class="line">      <span class="comment">// Send a request to our PHP signing endpoint.</span></div><div class="line">      <span class="keyword">return</span> fetch(<span class="string">'/s3-sign.php'</span>, &#123;</div><div class="line">        <span class="attr">method</span>: <span class="string">'post'</span>,</div><div class="line">        <span class="comment">// Send and receive JSON.</span></div><div class="line">        headers: &#123;</div><div class="line">          <span class="attr">accept</span>: <span class="string">'application/json'</span>,</div><div class="line">          <span class="string">'content-type'</span>: <span class="string">'application/json'</span></div><div class="line">        &#125;,</div><div class="line">        <span class="attr">body</span>: <span class="built_in">JSON</span>.stringify(&#123;</div><div class="line">          <span class="attr">filename</span>: file.name,</div><div class="line">          <span class="attr">contentType</span>: <span class="string">`<span class="subst">$&#123;file.type.general&#125;</span>/<span class="subst">$&#123;file.type.specific&#125;</span>`</span></div><div class="line">        &#125;)</div><div class="line">      &#125;).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</div><div class="line">        <span class="comment">// Parse the JSON response.</span></div><div class="line">        <span class="keyword">return</span> response.json()</div><div class="line">      &#125;).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</div><div class="line">        <span class="comment">// Return an object in the correct shape.</span></div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">          <span class="attr">method</span>: data.method,</div><div class="line">          <span class="attr">url</span>: data.url,</div><div class="line">          <span class="attr">fields</span>: &#123;&#125;</div><div class="line">        &#125;</div><div class="line">      &#125;)</div><div class="line">    &#125;</div><div class="line">  &#125;)</div></pre></td></tr></table></figure>
<p>See the <a href="https://github.com/transloadit/uppy/tree/master/examples/aws-presigned-url" target="_blank" rel="external">aws-presigned-url example in the uppy repository</a> for a small example that implements both the server-side and the client-side.</p>

    
    <div class="footer">Caught a mistake or want to contribute to the documentation?
       <a href="https://github.com/transloadit/uppy/blob/master/website/src/docs/aws-s3.md" target="_blank">Edit/fork this page directly on Github</a>!
    </div>
</div>

        
      </main>

      <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63083-12', 'uppy.io');
  ga('send', 'pageview');
</script>


      
        <script src="/js/smooth-scroll.min.js"></script>
      
      <script src="/js/common.js"></script>

      <!-- Twitter follow button script -->
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

      <!--script src="//ajax.googleapis.com/ajax/libs/webfont/1.6.16/webfont.js"></script>
      <script>
        WebFont.load({
          google: {
            families: ['Source Sans Pro:400,600', 'Roboto Mono', 'Poiret One:400']
          }
        });
      </script-->
    </div>
  </body>
</html>
